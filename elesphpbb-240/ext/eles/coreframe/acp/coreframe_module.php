<?php
namespace eles\coreframe\acp; class coreframe_module { protected $cache; protected $config; protected $config_text; protected $db; protected $phpbb_log; protected $request; protected $template; protected $user; protected $language; protected $phpbb_root_path; protected $phpEx; public $u_action; public function main($spac394a, $spede68f) { global $cache, $config, $db, $phpbb_log, $request, $template, $user, $spe31c2e, $phpEx, $phpbb_container; $this->cache = $cache; $this->config = $config; $this->config_text = $phpbb_container->get('config_text'); $this->db = $db; $this->phpbb_log = $phpbb_log; $this->request = $request; $this->template = $template; $this->user = $user; $this->language = $phpbb_container->get('language'); $this->phpbb_root_path = $spe31c2e; $this->phpEx = $phpEx; switch ($spede68f) { case 'general': break; case 'ads': break; case 'menus': break; case 'style': break; case 'template': break; case 'widgets': break; } $this->page_title = 'C_ACP_' . strtoupper($spede68f); $this->tpl_name = "mode-{$spede68f}"; $sp5a6c2f = (require __DIR__ . '/../opts/opts-schema.php'); $sp480c30 = 'coreframe_opts'; add_form_key($sp480c30); $sp8df73b = ''; if ($this->request->is_set_post('submit')) { if (!check_form_key($sp480c30)) { $sp8df73b = $this->language->lang('FORM_INVALID'); } $spc73231 = array(); foreach (array_keys($sp5a6c2f) as $sp762b0e) { if ($this->request->is_set($sp762b0e)) { $spc73231[$sp762b0e] = $this->request->variable($sp762b0e, '', true); } } if (empty($sp8df73b)) { foreach ($spc73231 as $sp762b0e => $specdb19) { if ('config_text' === $sp5a6c2f[$sp762b0e]) { $this->config_text->set($sp762b0e, $specdb19); } else { $this->config->set($sp762b0e, $specdb19); } } if ('general' === $spede68f) { $sp59d322 = array(); $spe8243e = $this->request->get_super_global(); $sp59d322 = $spe8243e['c_sidebar_pages']; $this->config_text->set('c_sidebar_pages', base64_encode(json_encode($sp59d322))); } if ('menus' === $spede68f) { $sp2f30b3 = array(); $spe8243e = $this->request->get_super_global(); foreach ($spe8243e as $spaa1bcb => $sp9fd2a6) { if (strpos($spaa1bcb, 'menu_item_text')) { foreach ($sp9fd2a6 as $sp18b676 => $specdb19) { if (!empty($specdb19)) { $sp2f30b3[$sp18b676]['text'] = $specdb19; $sp2f30b3[$sp18b676]['href'] = $spe8243e['c_menu_item_href'][$sp18b676]; $sp2f30b3[$sp18b676]['icon'] = $spe8243e['c_menu_item_icon'][$sp18b676]; } } } } $sp2f30b3 = $sp2f30b3 ? base64_encode(json_encode($sp2f30b3)) : ''; $this->config_text->set('c_menu_items', $sp2f30b3); $spcddf3a = array(); $spe8243e = $this->request->get_super_global(); $spcddf3a = $spe8243e['c_social_links']; $this->config_text->set('c_social_links', base64_encode(json_encode($spcddf3a))); } if ('style' === $spede68f) { $sp532335 = array(); $spe8243e = $this->request->get_super_global(); $sp532335 = $spe8243e['c_style_vars']; $this->config_text->set('c_style_vars', base64_encode(json_encode($sp532335))); } if ('template' === $spede68f) { $sp2e0391 = array(); $spe8243e = $this->request->get_super_global(); $sp2e0391 = $spe8243e['c_sidebar_widgets']; $spccce93 = $spe8243e['c_footer_widgets']; $this->config_text->set('c_sidebar_widgets', base64_encode(json_encode($sp2e0391))); $this->config_text->set('c_footer_widgets', base64_encode(json_encode($spccce93))); } $this->phpbb_log->add('admin', $this->user->data['user_id'], $this->user->ip, 'C_ACP_LOG'); $this->cache->destroy('_coreframe_data'); trigger_error($this->language->lang('C_UPDATED') . adm_back_link($this->u_action)); } } $sp475b0f = array(); $sp3160f6 = $this->config_text->get_array(array_keys($sp5a6c2f)); $sp532335 = json_decode(base64_decode($this->config_text->get('c_style_vars')), true); if ($sp532335) { foreach ($sp532335 as $spaa1bcb => $specdb19) { $sp475b0f['C_STYLE_VARS_' . strtoupper($spaa1bcb)] = $specdb19; } } $sp59d322 = json_decode(base64_decode($this->config_text->get('c_sidebar_pages')), true); $sp3160f6['c_sidebar_pages'] = $sp59d322; foreach ($sp5a6c2f as $sp762b0e => $spa90326) { if ('config_text' === $spa90326) { $sp475b0f[strtoupper($sp762b0e)] = $sp3160f6[$sp762b0e]; } else { $sp475b0f[strtoupper($sp762b0e)] = $this->config[$sp762b0e]; } } $this->template->assign_vars(array_merge($sp475b0f, array('ERRORS' => $sp8df73b, 'C_ACP_ON' => true, 'U_ACTION' => $this->u_action))); } }